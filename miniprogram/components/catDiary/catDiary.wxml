<view style="height: 100%;width: 100%;background-color: aliceblue;">
    <view>
        <view class="header">
            <view class="header-content">
                <slot name="header"></slot>
            </view>
            <span class="header-default">{{cat.name}}çš„æ—¥è®°
                <span class="sub-header">
                    <l-icon name="left" l-class="icon-left" bind:tap="goYesterday" />
                    <span style="align-items: center;justify-content: center;display: flex;" bind:tap="changeOpen">{{currentDate}}
                        <image src="/images/rili.svg" style="height: 30rpx;width: 30rpx;padding: 0 10rpx;"></image>
                    </span>
                    <l-icon name="right" l-class="icon-right" bind:tap="goNextDay" />
                </span>
            </span>
        </view>
        <view></view>
    </view>

    <scroll-view style="height: 900rpx;margin:10rpx 20rpx;width: auto;padding-bottom: 20rpx; " scroll-y="true">
        <block wx:if="{{isOpenDate}}">
            <calendar marks="{{marks}}" style="width: 100%;--wc-bg-light: aliceblue;--wc-corner-size: 17.5rpx;" id="calendar" bindload="handleLoad" bindchange="changeDate" darkmode="false" vibrate="{{false}}" date="{{currentDate}}" />
        </block>
        <view class="content {{animation?'flip-'+direction:''}}">
            <view wx:for="{{diary}}" wx:key="index" style="width: 100%;">
                <view>
                    <text style="font-weight: bold"> {{item.time}} </text>
                    <span class="text {{item.link.length > 0 ? 'text-with-media' : ''}}" bindtap="showDetails" bind:longtap="openAction" data-index="{{index}}">{{item.content}}</span>

                    <text>\n</text>
                </view>
            </view>

            <view class="edit" hidden="{{animation || !canEdit}}">
                <l-icon name="edit" color="#a2d2ff" class="edit-icon" /><text class="edit-text" bind:tap="openEdit">æ·»åŠ ä¸€æ¡</text>
            </view>
        </view>
    </scroll-view>

    <l-popup show="{{popShow}}" l-class="popup-container" content-align="center">
        <view class="popup-content">
            <view class="popup-header">
                <text class="popup-title">æ·»åŠ å–µæ—¥è®°</text>
                <l-icon name="close" size="32" color="#5B8FF9" bindtap="closePopup" />
            </view>
            <scroll-view scroll-y="true" style="height: 500rpx;">
                <view class="form-item">
                    <text class="label">æ—¥æœŸ <text class="cat-emoji">ğŸ±</text></text>
                    <view class="date-display uneditable">
                        <text>{{currentDate}}</text>
                    </view>
                </view>

                <view class="form-item animation-fade-in" style="animation-delay: 0.1s;">
                    <text class="label">ç•™å½±æ—¶é—´ <text class="cat-emoji">â°</text></text>
                    <picker mode="time" value="{{currentTime}}" bindchange="bindTimeChange">
                        <view class="picker">
                            {{currentTime}}
                            <view class="cat-tail"></view>
                        </view>
                    </picker>
                </view>

                <view class="form-item animation-fade-in" style="animation-delay: 0.2s;">
                    <text class="label">å–µçš„å¿ƒæƒ… <text class="cat-emoji">ğŸ“</text></text>
                    <view class="textarea-container">
                        <textarea placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆå¥½ç©çš„äº‹å–µï¼Ÿ100å­—ä»¥å†…" value="{{content}}" placeholder-class="placeholder-class" maxlength="100" bindinput="onContentChange" auto-height cursor-spacing="20"></textarea>
                        <view class="paw-print"></view>
                    </view>
                </view>

                <view class="form-item animation-fade-in" style="animation-delay: 0.3s;">
                    <view class="label-container">
                        <text class="label">å–µçš„ç…§ç‰‡/è§†é¢‘ <text class="cat-emoji">ğŸ“¸</text></text>
                        <view class="note-container">
                            <text class="note-text"> è¯¥é¡¹å¹¶éå¿…å¡«é¡¹ï¼ŒæŒ‰éœ€ä¸Šä¼ å³å¯</text>
                            <text class="note-text"> ç…§ç‰‡å’Œè§†é¢‘åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡5ä¸ª</text>
                            <text class="note-text"> ä¸Šä¼ çš„è§†é¢‘æœ€å¤§ä¸º200MB</text>
                        </view>
                    </view>
                    <block>
                    <uploader id="uploader" deletable="{{ true }}" max-count="5" bind:after-read="afterRead" multiple="{{ true }}" bind:delete="delete"/>
                </block>
                </view>


            </scroll-view>
            <view class="checkbox-container animation-fade-in" style="animation-delay: 0.4s;">
                <checkbox-group bindchange="onSyncAlbumChange">
                    <label class="checkbox-label">
                        <checkbox value="sync" checked="{{syncToAlbum}}" color="#5B8FF9" />
                        <text>åŒæ­¥ä¸Šä¼ ç…§ç‰‡åˆ°çŒ«å’ªç›¸å†Œå—ï¼Ÿ</text>
                    </label>
                    <label class="checkbox-label">
                        <checkbox value="msg" checked="{{getMsg}}" bind:tap="sendMsg" color="#5B8FF9" />
                        <text>æ¥å—å®¡æ ¸ç»“æœé€šçŸ¥</text>
                    </label>
                </checkbox-group>
            </view>

            <view class="submit-btn" bind:tap="submitForm">
                <button class="custom-button">æäº¤
                </button>
            </view>
            <view class="validation-error" wx:if="{{validationError}}">
                {{validationError}}
            </view>

        </view>
    </l-popup>
    <!-- æäº¤æˆåŠŸå¼¹çª— -->
    <l-popup show="{{submitPopShow}}" l-class="popup-container" content-align="center">
        <view class="success-popup">
            <view class="success-icon">âœ¨</view>
            <text class="success-title">å–µè®°æäº¤æˆåŠŸå•¦ï¼</text>
            <text class="success-desc">å®¡æ ¸åå°±èƒ½åœ¨æ—¥è®°æœ¬é‡Œçœ‹åˆ°å•¦~</text>
            <view class="success-cats">
                <text class="cat-emoji">ğŸ±</text>
                <text class="cat-emoji">ğŸ±</text>
                <text class="cat-emoji">ğŸ±</text>
            </view>
        </view>
    </l-popup>

    <l-popup show="{{showMedia}}" l-class="popup-container" bind:lintap="hidePopup">
        <view class="popup-content">
            <view class="popup-header">
                <text class="popup-title">å–µæ—¥è®°è¯¦ç»†</text>
                <l-icon name="close" size="32" color="#5B8FF9" bindtap="hidePopup" />
            </view>
            <scroll-view>
                <swiper style="width: 100%;" autoplay="{{false}}" indicator-dots indicator-active-color="#5B8FF9" class="media-swiper" wx:if="{{mediaList.length>0}}">
                    <!-- å¾ªç¯æ˜¾ç¤ºå›¾ç‰‡æˆ–è§†é¢‘ -->
                    <swiper-item wx:for="{{mediaList}}" wx:key="url" style="position:absolute;height: auto;">
                        <scroll-view bind:tap="preview" data-index="{{index}}">
                            <image wx:if="{{item.type === 'image'}}" src="{{item.url}}" class="media-image" mode="aspectFit" />
                            <video wx:if="{{item.type === 'video'}}" src="{{item.url}}" controls class="media-video"></video>
                        </scroll-view>
                    </swiper-item>
                </swiper>
            </scroll-view>
            <view class="diary-content-container">
                <view class="diary-text-content animation-fade-in">
                    <view class="cat-thought-bubble">
                        <view class="cat-name">
                            <view class="cat-emoji">ğŸ±</view>
                            {{cat.name}}
                            <view class="cat-tail"></view>
                        </view>
                        <view class="diary-time">{{diaryDetails.time}}</view>
                        <view class="diary-content {{isExpanded ? 'expanded' : ''}}">
                            <text class="content-prefix">å–µ~ </text>
                            <text class="content-text">{{diaryDetails.content}}</text>
                        </view>
                        <view wx:if="{{diaryDetails.content.length > 50}}" class="expand-button" bindtap="toggleExpand">
                            {{isExpanded ? 'æ”¶èµ·å–µ' : 'å±•å¼€å–µ'}}
                            <view class="paw-icon {{isExpanded ? 'rotate' : ''}}">ğŸ¾</view>
                        </view>
                    </view>
                    <view class="floating-fish">ğŸŸ</view>
                </view>
            </view>

        </view>
    </l-popup>
</view>